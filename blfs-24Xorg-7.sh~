#!/bin/bash
# BLFS 10.1 Build Script

package_name=""
package_ext=""

begin() {
	package_name=$1
	package_ext=$2
	
	echo "[lfs-scripts] Starting build of $package_name at $(date)"
        cd /sources	
	tar xf $package_name.$package_ext
	cd $package_name
}

finish() {
	echo "[lfs-scripts] Finishing build of $package_name at $(date)"

	cd /sources
	rm -rf $package_name
}

cd /sources

# https://www.x.org/pub/individual/util/util-macros-1.19.3.tar.bz2
wget --no-check-certificate  https://www.x.org/pub/individual/util/util-macros-1.19.3.tar.bz2
begin util-macros-1.19.3 tar.bz2
./configure $XORG_CONFIG
make install 
finish

# https://xorg.freedesktop.org/archive/individual/proto/xorgproto-2021.5.tar.bz2
wget --no-check-certificate  https://xorg.freedesktop.org/archive/individual/proto/xorgproto-2021.5.tar.bz2
begin xorgproto-2021.5 tar.bz2
mkdir build &&
cd    build &&
meson --prefix=$XORG_PREFIX -Dlegacy=true .. &&
ninja
sudo ninja install &&
sudo install -vdm 755 $XORG_PREFIX/share/doc/xorgproto-2021.5 &&
sudo install -vm 644 ../[^m]*.txt ../PM_spec $XORG_PREFIX/share/doc/xorgproto-2021.5
finish

# https://www.x.org/pub/individual/lib/libXau-1.0.9.tar.bz2
wget --no-check-certificate  https://www.x.org/pub/individual/lib/libXau-1.0.9.tar.bz2
begin libXau-1.0.9 tar.bz2
./configure $XORG_CONFIG &&
make
sudo make install
finish

# https://www.x.org/pub/individual/lib/libXdmcp-1.1.3.tar.bz2
wget --no-check-certificate  https://www.x.org/pub/individual/lib/libXdmcp-1.1.3.tar.bz2
begin libXdmcp-1.1.3 tar.bz2
./configure $XORG_CONFIG --docdir=/usr/share/doc/libXdmcp-1.1.3 &&
make
sudo make install
finish

# https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-1.14.1.tar.xz
wget --no-check-certificate  https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-1.14.1.tar.xz
begin xcb-proto-1.14.1 tar.xz
PYTHON=python3 ./configure $XORG_CONFIG
sudo make install
finish

# https://xorg.freedesktop.org/archive/individual/lib/libxcb-1.14.tar.xz
wget --no-check-certificate  https://xorg.freedesktop.org/archive/individual/lib/libxcb-1.14.tar.xz
begin libxcb-1.14 tar.xz
CFLAGS="${CFLAGS:--O2 -g} -Wno-error=format-extra-args" \
PYTHON=python3                \
./configure $XORG_CONFIG      \
            --without-doxygen \
            --docdir='${datadir}'/doc/libxcb-1.14 &&
make
sudo make install
finish




#  Cleaning Up
rm -rf /tmp/*a
echo "blfs-24.sh"
cat  /sources/24.log

